<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="The road ahead is bright, keeping the unity of knowing and doing.">
<meta property="og:type" content="website">
<meta property="og:title" content="smith-dog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="smith-dog">
<meta property="og:description" content="The road ahead is bright, keeping the unity of knowing and doing.">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="smith-dog">
<meta name="twitter:description" content="The road ahead is bright, keeping the unity of knowing and doing.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'smith-dog'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>smith-dog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-116674168-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">smith-dog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-travel">
          <a href="/travel" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-image"></i> <br />
            
            travel
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/26/阿里巴巴Java开发手册--抄写/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="smith-dog">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="smith-dog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/26/阿里巴巴Java开发手册--抄写/" itemprop="url">阿里巴巴Java开发手册---抄写</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-26T15:47:00+08:00">
                2018-09-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/09/26/阿里巴巴Java开发手册--抄写/" class="leancloud_visitors" data-flag-title="阿里巴巴Java开发手册---抄写">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>tags: </p>
<ul>
<li>前端</li>
<li>hexo<br>categories: </li>
<li>前端</li>
</ul>
<h4 id="一、编程规约"><a href="#一、编程规约" class="headerlink" title="一、编程规约"></a>一、编程规约</h4><h5 id="（一）命名风格"><a href="#（一）命名风格" class="headerlink" title="（一）命名风格"></a>（一）命名风格</h5><p>1、命名不能以下划线，美元符号开始或者结束。<br>2、不允许出现拼音和中文的出现，除了国际通用名。<br>3、类名使用UpperCameCase风格，但是DO/BO/DTO/VO/AO/PO/UID等例外。<br>4、方法名、变量名、成员变量、局部变量统一使用lowerCamelCase风格，必须遵从驼峰形式。<br>5、常量命名全部大写，单词间用下划线隔开，力求语义表达完整清除，不要嫌名字长。<br>6、抽象类命名使用Abstract或者Base开头；异常类命名使用Exception结尾；测试类命名以它要测试的类的名称开始，以Test结尾。<br>7、类型与中括号紧挨相连表示数组。<br>例：int[] i;  反例 int i[];<br>8、POJO类中布尔类型的变量，都不要加is，否则部分框架解析会引起序列化错误。<br>9、包名统一使用小写，点分隔之间有且仅有一个自然语义的英语单词。包名统一使用单数形式。类名如果有复数含义，类名可以使用复数形式。<br>10、杜绝完全不规范的缩写，避免望文不知义。<br>11、为了达到代码自解释的目的，任何自定义编程元素在命名时，使用尽量完整的单词组合来表达其意。<br>12、如果模块、接口、类、方法使用了设计模式，在命名时需要体现出具体模式。如factory、proxy、observer。<br>13、接口类中的方法和属性不要加任何修饰符号。尽量不要在接口中定义变量，如果一定要定义变量，肯定是与接口方法相关，并且是整个应用的基础常量。<br>14、对于Service和DAO类，基于SOA的理念，暴露出来的服务一定是接口，内部实现类用Impl的后缀与接口区别。<br>如果是形容能力的接口名称，取对应形容词为接口名。<br>15、枚举类名建议带上Enum后缀，枚举成员名称需要全部大写，单词用下划线隔开。<br>16、各层命名规约：<br>Service/DAO：<br>(1)获取单个对象的方法用get做前缀。<br>(2)获取多个对象的方法用list做前缀，复数形式结尾如listObjects。<br>(3)获取统计值的方法使用count做前缀。<br>(4)插入的方法用save/insert做前缀。<br>(5)删除的方法用remove/delete做前缀。<br>(6)修改的方法用update做前缀。<br>领域模型命名规约<br>(1)数据对象：xxxDO,xxx为数据表名<br>(2)数据传输对象:xxxDTO,xxx为业务领域相关的名称<br>(3)展示对象:xxxVO,xxx一般为网页名称<br>(4)POJO是DO/DTO/BO/VO的同城，禁止命名成xxxPOJO</p>
<hr>
<h5 id="（二）常量定义"><a href="#（二）常量定义" class="headerlink" title="（二）常量定义"></a>（二）常量定义</h5><p>1、不允许任何魔法值（未经预先定义的常量）直接出现在代码中<br>2、在long或者Long赋值时，数值后使用大写的L，不能时小写的l，小写容易跟数字1混淆，造成误解。<br>3、常量应该按功能归类，分开维护。<br>4、常量的复用层次有五层：跨应用共享常量、应用内共享常量、子工程内共享常量、包内共享常量、类内共享常量。<br>跨应用共享常量：放置在第二方库通常是client.jar中的constant目录下<br>应用内共享常量：放置在第一方库，在子模块constant下<br>子工程内共享常量：放置在当前子工程constant目录<br>包内共享常量：当前包下单独的constant目录下<br>类内共享常量：当前类下进行定义</p>
<p>5、变量值仅在一个固定范围内变化用enum类型定义</p>
<h5 id="（三）代码格式"><a href="#（三）代码格式" class="headerlink" title="（三）代码格式"></a>（三）代码格式</h5><p>1、大括号使用约定。<br>    (1)左大括号前不换行<br>   (2)左大括号后换行<br>   (3)右大括号前换行<br>   (4)右大括号后还有else等代码不换行：表示终止的右大括号后必须换行。<br>2、左小括号和字符之间不出现空格：右小括号和字符之间也不出现空格；而左大括号前需要空格。<br>3、if/for/while/switch/do 等保留与括号之间都必须加空格。<br>4、任何二目运算符、三目运算符的左右两边都需要加一个空格。<br>5、才用4个空格缩进，进制使用tab字符。<br>6、注释的双斜线与注释内容之间有且只有一个空格。<br>7、单行字数限制不超过120个，超出需要换行，换行遵循如下原则：<br>(1)第二行相对第一行缩进4个空格，从第三行开始，不再继续缩进<br>(2)运算符与下文一起换行<br>(3)方法调用的点符号与下文一起换行<br>(4)方法调用中的多个参数需要换行时，在逗号后进行<br>(5)在括号前不要换行</p>
<p>8、方法参数在定义和传入时，多个参数逗号后边必须加空格。</p>
<p>9、IDE的text file encoding 设置为utf-8;ide中文件的换行符使用unix格式，不要使用window格式。<br>10、单个方法的总行数不超过80行。包括签名、括号，注释以及不可见字符。<br>11、没有必要增加若干空格来使某一行的字符对齐上一行的对应字符。<br>12、不同逻辑、不同语义、不同业务的代码之间插入一个空行分隔开来以提升可读性。</p>
<h5 id="（四）OOP规约"><a href="#（四）OOP规约" class="headerlink" title="（四）OOP规约"></a>（四）OOP规约</h5><p>1、避免通过一个类的对象引用访问此类的静态变量或者静态方法，无谓增加编译器成本，直接使用类名访问。</p>
<p>2、所有的重载方法，必须加<figure class="highlight plain"><figcaption><span>```注解</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">3、相同参数类型，相同业务含义，才可以使用Java可变参数，避免使用Object。</span><br><span class="line">4、外部正在调用或者二方库依赖的接口，不允许修改方法的签名，避免对接口调用产生影响。接口过时必须用``` @Deprecated ```注解，并清晰地说明才用的新接口或者新服务是什么。</span><br><span class="line">5、不能使用过时的类或者方法。</span><br><span class="line">6、Object的equals方法容易抛空指针异常，应使用常量或确定有值的对象来调用equals。</span><br><span class="line">7、所有的相同类型的包装类对象之间值的比较，全部使用equals方法比较</span><br><span class="line">8、基本数据类型与包装数据类型的使用标准如下</span><br><span class="line">(1)所有的POJO类属性必须使用包装数据类型</span><br><span class="line">(2)RPC方法的返回值和参数必须使用包装数据类型</span><br><span class="line">(3)所有的局部变量使用基本数据类型</span><br><span class="line">9、定义DO/DTO/VO等POJO类时，不要设定任何属性默认值。</span><br><span class="line">10、序列化类新增属性的时候，不修改serialVersionUID字段，避免反序列化失败。</span><br><span class="line"></span><br><span class="line">11、构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，放在init方法中。</span><br><span class="line"></span><br><span class="line">12、POJO类必须写toString。使用IDE工具自动生成，如果继承了另外的POJO类，注意在前面加一下super.toString.</span><br><span class="line"></span><br><span class="line">13、禁止在POJO类中，同时存在对应属性xxx的isXxx（）和getXxxx（）方法。</span><br><span class="line"></span><br><span class="line">14、使用索引访问用String的split方法得到的数组时，需做最后一个分隔符后有无内容的检查，否则有抛出IndexOutOfBoundException的风险。</span><br><span class="line"></span><br><span class="line">15、当一个类有多个构造方法，或者多个同名方法，这些方法应该按顺序放置在一起，便于阅读，此条优先于第16条规则。</span><br><span class="line"></span><br><span class="line">16、类内方法定义的顺序依次是：公有方法或保护方法&gt;私有方法&gt;getter/setter方法。</span><br><span class="line"></span><br><span class="line">17、setter方法中，参数名称与类成员变量名称一致，this.成员名 = 参数名。在getter/setter方法中，不要增加业务逻辑，增加排查问题的难度。</span><br><span class="line"></span><br><span class="line">18、循环体内，字符串的连接方式，使用StringBuilder的append方法进行扩展。</span><br><span class="line"></span><br><span class="line">19、final可以声明类、成员变量、方法、以及本地变量，下列情况使用final关键字：</span><br><span class="line">（1）不允许被继承的类，如String类</span><br><span class="line">（2）不允许修改引用的域对象</span><br><span class="line">（3）不允许被重写的方法，如：POJO类的setter方法</span><br><span class="line">（4）不允许运行过程中重新赋值的局部变量。</span><br><span class="line">（5）避免上下文重复使用的一个变量，使用final描述可以强制重新定义一个变量，方便更好的重构。</span><br><span class="line"></span><br><span class="line">20慎用Object的clone方法来拷贝对象。</span><br><span class="line"></span><br><span class="line">21类成员与方法访问控制从严：</span><br><span class="line">（1）如果不允许外部直接通过new来创建对象，构造方法必须是private</span><br><span class="line">（2）工具类不允许有public 或者default构造方法</span><br><span class="line">（3）类非static成员变量并且与子类共享，必须是protected。</span><br><span class="line">（4）类非static成员变量并且仅在本类使用，必须是private。</span><br><span class="line">（5）类static成员变量如果仅在本类使用，必须是private。</span><br><span class="line">（6）若是static成员变量，考虑是否为final。</span><br><span class="line">（7）类成员方法只供类内部调用，必须是private</span><br><span class="line">（8）若类成员方法只对继承公开，那么限制为protected。</span><br><span class="line"></span><br><span class="line">##### （四）集合处理</span><br><span class="line"></span><br><span class="line">1、关于hashCode和equals的处理</span><br><span class="line">	（1）只要重写equals，就必须重写hashCode</span><br><span class="line">   （2）因为Set存储不重复对象，依据hashCode和equals进行判断，所以Set存储的对象必须重写这两个方法。</span><br><span class="line">   （3）如果自定义对象作为Map的键，那么必须重写hashCode和equeals</span><br><span class="line">   </span><br><span class="line">2、ArrayList的subList结果不可强转成ArrayList否则会抛出ClassCaseException异常，即java.utilRandomAccessSubList cannot be cast to java.util.ArrayList.</span><br><span class="line"></span><br><span class="line">3、在subList场景中，高度注意对原集合元素的增加或删除，均会导致子列表的遍历、增加、删除产生ConcurrentModificationException 异常。</span><br><span class="line"></span><br><span class="line">4、使用集合转数组的方法，必须使用集合的```toArray(T[] array)```, 传入的是类型完全一样的数组，大小就是```list.size()```.</span><br><span class="line">直接使用toArray无参方法存在问题，此方法返回值只能是```Object[]```类，若强转其它类型数组将出现ClassCastException错误。</span><br><span class="line">5、使用工具类Array.asList()把数组转换成集合时，不能使用其修改集合相关的方法，它的add/remove/clear方法会抛出UnsupportedOperationException异常。</span><br><span class="line"></span><br><span class="line">6、泛型通配符&lt;? extends T&gt;来接收返回的数据，此写法的泛型集合不能使用add方法，而&lt;? super T&gt;不能使用get方法，作为接口调用赋值时易出错，PECS原则：第一、频繁往外读取内容的，适合用&lt;? extends T&gt;. 第二、经常往里插入的，适用用&lt;? super T&gt;.</span><br><span class="line"></span><br><span class="line">7、不要foreach循环里进行元素的remove/add操作。remove元素请适用Iterator方式，如果并发，需要对Iterator对象加锁。</span><br><span class="line"></span><br><span class="line">8、在JDK1.7版本及以上，Comparator实现类要满足以下三个条件，不然Array.sort，Collections.sort会报IllegalgumentException异常。</span><br><span class="line"></span><br><span class="line">9、集合泛型定义时，在JDK7及以上，使用diamond语法或者全省略。</span><br><span class="line">说明：菱形泛型，即diamond，使用&lt;&gt;代替前面指定的类型。</span><br><span class="line"></span><br><span class="line">10、集合初始化时，指定集合初始化大小</span><br><span class="line">例：HashMap，initialCapacity=(需要存储的元素个数/负载因子) + 1。注意负载因子（即loader factor）默认为0.75，如果暂时无法确定初始值大小，请设置为16（即默认值）。HashMap需要放置1024个元素，由于没有设置容量初始大小，随着元素不断增加，容量7次被迫扩大，resize需要重建hash表，严重影响性能。</span><br><span class="line"></span><br><span class="line">11、使用entrySet遍历Map类集合KV，而不是keySet方式进行遍历。</span><br><span class="line">说明：keySet其实是遍历了2次，一次是转为Iterator对象，另一次是从hashMap中取出key所对应的value。而entrySet只是遍历了一次就把key和value都放到了entry中，效率更高。如果是JDK8，使用Map.foreach方法。</span><br><span class="line"></span><br><span class="line">12、高度注意Map类集合K/V能不能存储null值的情况，如下表格</span><br><span class="line"></span><br><span class="line">|集合类|Key|Value|Super|说明|</span><br><span class="line">|---|:--:|---:|</span><br><span class="line">|Hashtable|不允许为null|不允许为null|Dictionary|线程安全|</span><br><span class="line">|ConcurrentHashMap|不允许为null|不允许为null|AbstractMap|锁分段技术（JDK8:CAS）|</span><br><span class="line">|TreeMap|不允许为null|允许为null|AbstractMap|线程不安全|</span><br><span class="line">|HashMap|允许为null|允许为null|AbstractMap|线程不安全|</span><br><span class="line"></span><br><span class="line">由于HashMap的干扰，很多人认为ConcurrentHashMap是可以置入null值，而事实上，存储null值时会抛出NPE异常。</span><br><span class="line"></span><br><span class="line">13、合理利用好集合的有序性(sort)和稳定性(order),避免集合的无序性(unsort)和不稳定性(unorder)带来的负面影响。</span><br><span class="line"></span><br><span class="line">14、利用Set元素唯一的特性，可以快速对一个集合进行去重操作，避免使用List的contains方法进行遍历、对比、去重操作。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### （六）并发处理</span><br><span class="line"></span><br><span class="line">1、获取单例对象需要保证线程安全，其中的方法也要保证线程安全。</span><br><span class="line"></span><br><span class="line">2、创建线程或线程池时请指定有意义的线程名称，方便出错时回溯。</span><br><span class="line"></span><br><span class="line">3、线程资源必须通过线程池提供，不允许在应用中自行显式创建线程。</span><br><span class="line">说明：使用线程池的好处是减少在创建和销毁线程上所消耗的时间以及系统资源的开销，解决资源不足的问题。如果不使用线程池，有可能造成系统创建大量同类线程而导致消耗完内存或者“过度切换”的问题。</span><br><span class="line"></span><br><span class="line">4、线程池不允许使用Executors去创建，而是通过ThreadPoolExecutor的方式，这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。</span><br><span class="line"></span><br><span class="line">5、SimpleDateFormat是线程不安全的类，一般不要定义为static变量，如果定义为static，必须加锁，或者使用DateUtils工具类。</span><br><span class="line"></span><br><span class="line">6、高并发时，同步调用应该考量锁的性能损耗。能用无锁数据结构，就不要用锁；能锁区块，就不要锁整个方法体；能用对象锁，就不要用类锁。</span><br><span class="line">说明：尽可能使加锁的代码块工作量尽可能的小，避免在锁代码块中调用RPC方法。</span><br><span class="line"></span><br><span class="line">7、对多个资源、数据库表、对象同时加锁时，需要保持一致的加锁顺序，否则可能会造成死锁。</span><br><span class="line"></span><br><span class="line">8、并发修改同一记录时，避免更新丢失，需要加锁。要么在应用层加锁，要么在缓存加锁，要么在数据库层使用乐观锁，使用version作为更新依据。</span><br><span class="line">说明：如果每次访问冲突概率小于20%，推荐使用乐观锁，否则使用悲观锁。乐观锁的重试次数不得小于3次</span><br><span class="line"></span><br><span class="line">9、多线程并行处理定时任务时，Timer运行多个TimeTask时，只要其中之一没有捕获抛出的异常，其它任务便会自动终止运行，使用ScheduleExecutorService则没有这个问题。</span><br><span class="line"></span><br><span class="line">10、使用CountDownLatch进行异步转同步操作，每个线程退出前必须调用countDown方法，线程执行代码注意catch异常，确保countDown方法被执行到，避免主线程无法执行至await方法，直到超时才返回结果。</span><br><span class="line"></span><br><span class="line">说明：注意，子线程抛出异常堆栈，不能在主线程try-catch到。</span><br><span class="line"></span><br><span class="line">11、避免Random实例被多线程使用，虽然共享该实例是线程安全的，但会因竞争同一seed导致的性能下降。</span><br><span class="line"></span><br><span class="line">12、在并发场景下，通过双重检查锁（double-checkedlocking）实现延迟初始化的优化问题隐患(可参考The&quot;Double-CheckedLockingisBroken&quot; Declaration)，推荐解决方案中较为简单一种（适用于JDK5及以上版本），将目标属性声明为volatile型。</span><br><span class="line"></span><br><span class="line">13、volatile 解决多线程内存不可见问题。对于一写多读，是可以解决变量同步问题，但是如果多写，同样无法解决线程安全问题。如果是count++操作，使用如下类实现：AtomicIntegercount= newAtomicInteger();count.addAndGet(1);如果是JDK8，推荐使用LongAdder对象，比AtomicLong性能更好（减少乐观锁的重试次数）。</span><br><span class="line"></span><br><span class="line">14、HashMap在容量不够进行resize时由于高并发可能出现死链，导致cpu飙升，在开发过程中可以使用其它数据结构或加锁来规避风险。</span><br><span class="line"></span><br><span class="line">15、ThreadLocal无法解决共享对象的更新问题，ThreadLocal对象建议使用static修饰。这个变量是针对一个线程内所有操作共享的，所以设置为静态变量，所有此类实例共享此静态变量，也就是说在类第一次被使用时装载，只分配一块存储空间，所有此类的对象(只要是这个线程内定义的)都可以操控这个变量。</span><br><span class="line"></span><br><span class="line">##### （七）控制语句</span><br><span class="line"></span><br><span class="line">1、在一个switch块内，每个case要么通过break/return等来终止，要么注释说明程序将继续执行到哪一个case为止；在一个switch块内，都必须包含一个default语句并且放在最后，即使空代码。</span><br><span class="line"></span><br><span class="line">2、在if/else/for/while/do语句中必须使用大括号。即使只有一行代码，避免采用单行的编码方式：if（condition）statements;</span><br><span class="line"></span><br><span class="line">3、在高并发场景中、避免使用“等于”判断作为中断或退出的条件。</span><br><span class="line">说明：如果并发控制没有处理好，容易产生等值判断被“击穿”的情况，使用大于或小于的区间判断条件来代替。</span><br><span class="line"></span><br><span class="line">4、表达异常的分支时，少用if-else方式，这种方式可以改成写成：</span><br><span class="line"></span><br><span class="line">超过3层的if-else的逻辑判断代码可以使用卫语句、策略模式、状态模式等来实现</span><br><span class="line"></span><br><span class="line">5、除常用方法（如getXxx/isXxx）等外，不要在条件判断中执行其它复杂语句，将复杂逻辑判断结果赋值给一个有意义的布尔变量名，以提高可读性。</span><br><span class="line">例子</span><br></pre></td></tr></table></figure></p>
<p>finalboolean existed = (file.open(fileName, “w”) != null) &amp;&amp;(…) || (…);if (existed) {…}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">6、循环体中的语句要考量性能，以下操作尽量移至循环体外处理，如定义对象、变量、获取数据库连接，进行不必要的try-catch操作（这个try-catch是否可以移至循环体外）。</span><br><span class="line"></span><br><span class="line">7、避免采取反逻辑运算符</span><br><span class="line"></span><br><span class="line">8、接口入参保护，这种场景常见的是用作批量操作的接口。</span><br><span class="line"></span><br><span class="line">9、下列情形，需要进行参数校验：</span><br><span class="line">(1)调用频次低的方法</span><br><span class="line">(2)执行时间开销很大的方法。此情形中，参数校验时间几乎可以忽略不计，但如果因为参数错误导致中间执行回退，或者错误，那得不偿失。</span><br><span class="line">(3)需要极高稳定性和可用性的方法</span><br><span class="line">(4)对外提供开放接口，不管是RPC/API/HTTP接口。</span><br><span class="line">(5)敏感权限入口。</span><br><span class="line"></span><br><span class="line">10、下列情形，不需要进行参数校验：</span><br><span class="line">(1)极有可能被循环调用的方法。但在方法说明里必须注明外部参数检查要求。</span><br><span class="line">(2)底层调用频度比较高的方法。比如DAO层</span><br><span class="line">(3)被声明成private只会被自己代码所调用的方法。</span><br><span class="line"></span><br><span class="line">##### （八）注释规约</span><br><span class="line"></span><br><span class="line">1、类、类属性、类方法的注释必须使用Javadoc规范，使用``` /**内容*/ ```格式,不得使用// xxx方式。</span><br><span class="line"></span><br><span class="line">2、所有的抽象方法必须要用Javadoc注释，说明返回值、参数、异常、子类实现要求、功能、调用注意事项。</span><br><span class="line"></span><br><span class="line">3、类必须添加创建者和创建日期。</span><br><span class="line"></span><br><span class="line">4、方法内部单行注释</span><br><span class="line"></span><br><span class="line">5、所有的枚举类型字段必须要有注释，说明每个数据项的用途</span><br><span class="line"></span><br><span class="line">6、与其“半吊子”英文来注释，不如用中文注释把问题说清楚。专有名词与关键字保持英文原文即可。</span><br><span class="line"></span><br><span class="line">7、代码修改的同时，注释也要进行相应的修改，尤其是参数、返回值、异常、核心逻辑等的修改。</span><br><span class="line"></span><br><span class="line">8、谨慎注释掉代码。在上方详细说明，而不是简单地注释掉。如果无用，则删除。</span><br><span class="line"></span><br><span class="line">9、对于注释的要求：第一、能够准确反应设计思想和代码逻辑；第二、能够描述业务含义，使别的程序员能够迅速了解到代码背后的信息。完全没有注释的大段代码对于阅读者形同天书，注释是给自己看的，即使隔很长时间，也能清晰理解当时的思路；注释也是给继任者看的，使其能够快速接替自己的工作。</span><br><span class="line"></span><br><span class="line">10、好的命名、代码结构是自解释的，注释力求精简准确、表达到位。避免出现注释的一个极端：过多过滥的注释，代码的逻辑一旦修改，修改注释是相当大的负担。</span><br><span class="line"></span><br><span class="line">11、及时清理TODO等标记</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### （九）其它</span><br><span class="line"></span><br><span class="line">1、在使用正则表达式时，利用好其预编译功能，可以有效加快正则匹配速度。</span><br></pre></td></tr></table></figure></p>
<p>private static final Pattern pattern = Pattern.compile(regexRule);<br><code>`</code><br>2、velocity调用POJO类的属性时，建议直接使用属性名取值即可，模板引擎会自动按规范调用POJO的getXxx()，如果是boolean基本数据类型变量（boolean命名不需要加is前缀），会自动调用isXxx()方法。</p>
<p>3、后台输送给页面的变量必须加$!{var} 中间的感叹号</p>
<p>4、注意Math.random()这个方法返回是double类型，注意取值的范围0≤x&lt;1（能够取到零值，注意除零异常），如果想获取整数类型的随机数，不要将x放大10的若干倍然后取整，直接使用Random对象的nextInt或者nextLong方法。</p>
<p>5、获取当前毫秒数System.currentTimeMillis();而不是newDate().getTime();说明：如果想获取更加精确的纳秒级时间值，使用System.nanoTime()的方式。在JDK8中，针对统计时间等场景，推荐使用Instant类。</p>
<p>6、不要在视图模板中加入任何复杂的逻辑。说明：根据MVC理论，视图的职责是展示，不要抢模型和控制器的活。</p>
<p>7、任何数据结构的构造或初始化，都应指定大小，避免数据结构无限增长吃光内存。</p>
<p>8、及时清理不再使用的代码段或配置信息。说明：对于垃圾代码或过时配置，坚决清理干净，避免程序过度臃肿，代码冗余。正例：对于暂时被注释掉，后续可能恢复使用的代码片断，在注释代码上方，统一规定使用三个斜杠(///)来说明注释掉代码的理由。</p>
<h4 id="二、异常日志"><a href="#二、异常日志" class="headerlink" title="二、异常日志"></a>二、异常日志</h4><p>(一)、异常处理<br>1、java类库中定义的可以通过预检查方式规避的异常，不应该通过catch处理，如NullPointException。</p>
<p>2、异常不要用来做流程控制</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/24/my-second/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="smith-dog">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="smith-dog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/24/my-second/" itemprop="url">redis历险--初探数据结构（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-24T22:57:03+08:00">
                2018-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/09/24/my-second/" class="leancloud_visitors" data-flag-title="redis历险--初探数据结构（一）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>title: 初探数据结构<br>tags:</p>
<ul>
<li>cache</li>
<li>redis</li>
<li>structure<br>categories: cache<br>date: 2018-09-25 13:44:12</li>
</ul>
<hr>
<p>本文是对redis常用数据结构的总结，不涉及应用，参考文档<a href="http://redisdoc.com/index.html" target="_blank" rel="noopener">http://redisdoc.com/index.html</a></p>
<h4 id="列表结构"><a href="#列表结构" class="headerlink" title="列表结构"></a>列表结构</h4><p>特点：有序，可以重复，左右弹出</p>
<table>
<thead>
<tr>
<th>指令</th>
<th style="text-align:center">指令使用</th>
<th style="text-align:right">时间复杂度</th>
<th>指令说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rpush</td>
<td style="text-align:center">rpush key value1 value2 … valueN</td>
<td style="text-align:right">o(1~n)</td>
<td>右增</td>
</tr>
<tr>
<td>lpush</td>
<td style="text-align:center">lpush key value1 value2 … valueN</td>
<td style="text-align:right">o(1~n)</td>
<td>左增</td>
</tr>
<tr>
<td>linsert</td>
<td style="text-align:center">linsert key before/after value newValue</td>
<td style="text-align:right">o(n)</td>
<td>插入</td>
</tr>
<tr>
<td>lpop/rpop</td>
<td style="text-align:center">lpop key   (左弹出)/rpop key   (右弹出)</td>
<td style="text-align:right">o(1)</td>
<td>删除</td>
</tr>
<tr>
<td>lrem</td>
<td style="text-align:center">lrem key count value</td>
<td style="text-align:right">o(n)</td>
<td>删除(删除指定个数的元素，相同的元素)</td>
</tr>
<tr>
<td>ltrim</td>
<td style="text-align:center">ltrim key start end</td>
<td style="text-align:right">o(1~n)</td>
<td>裁剪(按照索引范围修剪列表)</td>
</tr>
<tr>
<td>lrange</td>
<td style="text-align:center">lrange key start end (包含end)</td>
<td style="text-align:right">o（n）</td>
<td>获取列表指定索引范围所有item</td>
</tr>
<tr>
<td>index</td>
<td style="text-align:center">index key index</td>
<td style="text-align:right">o(n)</td>
<td>获取列表指定下标的元素</td>
</tr>
<tr>
<td>llen</td>
<td style="text-align:center">llen key</td>
<td style="text-align:right">o(1)</td>
<td>获取列表长度</td>
</tr>
<tr>
<td>lset</td>
<td style="text-align:center">lset key index newValue</td>
<td style="text-align:right">o(n)</td>
<td>设置列表指定索引值为指定值</td>
</tr>
</tbody>
</table>
<p>lrem指令说明</p>
<blockquote>
<p>1、count &gt;0 ,从左到右，删除最多count个value相等的项<br>2、count&lt;0，从右到左，删除最多Math.abs(count)个value相等的项<br>3、count=0, 删除所有value相等的项</p>
</blockquote>
<p>ltrim key start end<br>按照索引范围修剪列表   o（n）</p>
<p>场景：大列表删除，每次裁剪剩下十分之一</p>
<p>实战 </p>
<pre><code>微博时间轴
</code></pre><p>微博的id作为key<br>新的微博 -&gt; weibpo12345-&gt; weibo546 -&gt; weibo1231-&gt;weibo1564354   </p>
<p>blopop/brpop key timeout</p>
<p>阻塞弹出<br>timeout = 0 永远不超时</p>
<p>实际场景</p>
<p>lpush + lpop = Stack<br>lpush + rpop = queue<br>lpush + ltrim = capped collection   (固定长度的队列)<br>lpush + brpop = message queue  （消息队列）</p>
<p> 集合结构</p>
<p>key                              values<br>user:1:follow            it 、music、his、sports</p>
<p>特点：<br>无序<br>不重复<br>集合间的api</p>
<p>scard<br>计算集合大小</p>
<p>sismember<br>判断是否在集合中</p>
<p>srandmember  （不会破坏集合）<br>从集合中随机挑count个元素</p>
<p>spop     （从集合弹出）<br>集合中随机弹出一个元素</p>
<p>smembers    （无序，小心使用，最好用scan）<br>获取集合中的所有元素</p>
<p>实战</p>
<p>抽奖——–从奖池中弹出获奖者<br>Like ，踩赞</p>
<p>标签</p>
<p>sadd user:1:tags tag1 tag2 tag3</p>
<p>sadd tag1:users user:1 user:2</p>
<p>集合间的api</p>
<p>sdiff</p>
<p>sinter </p>
<p>sunion</p>
<p>两个集合<br>集合1 user:1:follow  it music his sports<br>集合2 user:2:follow it news ent sports</p>
<p>sdiff user:1:follow user:2:follow = music his #差集</p>
<p>sinter user:1:follow user:2:follow = it sports #交集</p>
<p>sunion user:1:follow user:2:follow = it music  his sports news ent #并集</p>
<p>sdiff|sinter|suion + store destkey … #将差集、交集、并集结果报错在destkey中</p>
<p>实战</p>
<p>微博共同关注</p>
<p>TIPS</p>
<p>SADD = Tagging </p>
<p>SPOP/SRANDMEMBER = Random item </p>
<p>SADD + SINTER = Social Graph</p>
<p>有序集合</p>
<p>key                         score           value<br>user:ranking              1                mike<br>user:ranking              2                tom </p>
<p>集合vs有序集合</p>
<p>无重复元素———无重复元素<br>无序——————-有序<br>element—————-element+score</p>
<p>列表vs有序集合<br>重复——————-无重复<br>有序——————-有序<br>element——————element+score</p>
<p>重要api</p>
<p>zadd  key score element(可以多对)  o(logN)<br>添加score 和element</p>
<p>zadd user:1:ranking 1 element1</p>
<p>zrem user:1:ranking element1</p>
<p>zincrby key increScore element  o(1)<br>增加或减少元素的分数</p>
<p>zcard key<br>返回元素的总个数  o（1）</p>
<p>zadd player:rank 1000 ronaldo 900 messi 800 c-ronaldo 600 kaka</p>
<p>zscore player:rank kaka</p>
<p>zcard player:rank</p>
<p>zrank player:rank ronaldo</p>
<p>zrem player:rank messi</p>
<p>zrange player:rank satrt end withscores<br>zrange player:rank 0 3 withscores<br>返回指定索引范围内的升序元素（是否打印元素分值）   o（log(n)+m）</p>
<p>zrange player:rank minscore maxscore   withscores<br>返回指定分值范围内的升序元素（是否打印元素分值）   o（log(n)+m）</p>
<p>zcount player:rank 3 40 withscores </p>
<p>zremrangebyrank key start end<br>删除指定排名内的升序元素</p>
<p>zremrangebyscore key minScore maxScore<br>返回指定分值内的元素</p>
<p>zadd player:rank 1000 ronaldo 900 messi 800 c-ronaldo 600 kaka</p>
<p>zcount player:rank 700 901<br>zrangebyscore player:rank  700 901<br>zremrangebyscore player:rank 0 1</p>
<p>实战<br>排行榜<br>新歌版、图书版、特价排行版</p>
<p>最新榜单–&gt;时间戳    销售版–&gt;销售量   关注版–&gt;关注量<br>score:timeStamp saleCount followCount</p>
<p>查漏补缺</p>
<p>zrevrank<br>从高到低排名<br>zrevrange</p>
<p>zrevrangebyscore</p>
<p>zinterstore</p>
<p>zunionstore</p>
<p>总结</p>
<p>操作类型 | 命令<br>基本操作 | zadd zrem zcard zincrby zscore<br>范围操作 | zrange zrangebyscore zcount zremrangebyrank<br>集合操作 | zunionstore zinterstore</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
  <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=298 height=52 src="//music.163.com/outchain/player?type=2&id=462698572&auto=1&height=32"></iframe>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/head.png"
                alt="smith-dog" />
            
              <p class="site-author-name" itemprop="name">smith-dog</p>
              <p class="site-description motion-element" itemprop="description">The road ahead is bright, keeping the unity of knowing and doing.</p>
          </div>
		  
		  
		  
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/smith-dog" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">smith-dog</span>

  
</div>
<!--

  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>


  -->

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("teOglp4okTXg4fqzdYTTgX7A-gzGzoHsz", "x1lkkmeCaofwDoun8IkhHl2E");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
