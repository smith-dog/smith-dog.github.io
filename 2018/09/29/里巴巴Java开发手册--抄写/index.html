<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="java,alibaba," />










<meta name="description" content="一、编程规约（一）命名风格1、命名不能以下划线，美元符号开始或者结束。2、不允许出现拼音和中文的出现，除了国际通用名。3、类名使用UpperCameCase风格，但是DO/BO/DTO/VO/AO/PO/UID等例外。4、方法名、变量名、成员变量、局部变量统一使用lowerCamelCase风格，必须遵从驼峰形式。5、常量命名全部大写，单词间用下划线隔开，力求语义表达完整清除，不要嫌名字长。6、抽">
<meta name="keywords" content="java,alibaba">
<meta property="og:type" content="article">
<meta property="og:title" content="alibaba java document">
<meta property="og:url" content="http://yoursite.com/2018/09/29/里巴巴Java开发手册--抄写/index.html">
<meta property="og:site_name" content="smith-dog">
<meta property="og:description" content="一、编程规约（一）命名风格1、命名不能以下划线，美元符号开始或者结束。2、不允许出现拼音和中文的出现，除了国际通用名。3、类名使用UpperCameCase风格，但是DO/BO/DTO/VO/AO/PO/UID等例外。4、方法名、变量名、成员变量、局部变量统一使用lowerCamelCase风格，必须遵从驼峰形式。5、常量命名全部大写，单词间用下划线隔开，力求语义表达完整清除，不要嫌名字长。6、抽">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-10-18T09:11:18.570Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="alibaba java document">
<meta name="twitter:description" content="一、编程规约（一）命名风格1、命名不能以下划线，美元符号开始或者结束。2、不允许出现拼音和中文的出现，除了国际通用名。3、类名使用UpperCameCase风格，但是DO/BO/DTO/VO/AO/PO/UID等例外。4、方法名、变量名、成员变量、局部变量统一使用lowerCamelCase风格，必须遵从驼峰形式。5、常量命名全部大写，单词间用下划线隔开，力求语义表达完整清除，不要嫌名字长。6、抽">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'smith-dog'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/09/29/里巴巴Java开发手册--抄写/"/>





  <title>alibaba java document | smith-dog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-116674168-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">smith-dog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-travel">
          <a href="/travel" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-image"></i> <br />
            
            travel
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/29/里巴巴Java开发手册--抄写/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="smith-dog">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="smith-dog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">alibaba java document</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-29T22:26:01+08:00">
                2018-09-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/statute/" itemprop="url" rel="index">
                    <span itemprop="name">statute</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/09/29/里巴巴Java开发手册--抄写/" class="leancloud_visitors" data-flag-title="alibaba java document">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h4 id="一、编程规约"><a href="#一、编程规约" class="headerlink" title="一、编程规约"></a>一、编程规约</h4><h5 id="（一）命名风格"><a href="#（一）命名风格" class="headerlink" title="（一）命名风格"></a>（一）命名风格</h5><p>1、命名不能以下划线，美元符号开始或者结束。<br>2、不允许出现拼音和中文的出现，除了国际通用名。<br>3、类名使用UpperCameCase风格，但是DO/BO/DTO/VO/AO/PO/UID等例外。<br>4、方法名、变量名、成员变量、局部变量统一使用lowerCamelCase风格，必须遵从驼峰形式。<br>5、常量命名全部大写，单词间用下划线隔开，力求语义表达完整清除，不要嫌名字长。<br>6、抽象类命名使用Abstract或者Base开头；异常类命名使用Exception结尾；测试类命名以它要测试的类的名称开始，以Test结尾。<br><a id="more"></a><br>7、类型与中括号紧挨相连表示数组。<br>例：int[] i;  反例 int i[];<br>8、POJO类中布尔类型的变量，都不要加is，否则部分框架解析会引起序列化错误。<br>9、包名统一使用小写，点分隔之间有且仅有一个自然语义的英语单词。包名统一使用单数形式。类名如果有复数含义，类名可以使用复数形式。<br>10、杜绝完全不规范的缩写，避免望文不知义。<br>11、为了达到代码自解释的目的，任何自定义编程元素在命名时，使用尽量完整的单词组合来表达其意。<br>12、如果模块、接口、类、方法使用了设计模式，在命名时需要体现出具体模式。如factory、proxy、observer。<br>13、接口类中的方法和属性不要加任何修饰符号。尽量不要在接口中定义变量，如果一定要定义变量，肯定是与接口方法相关，并且是整个应用的基础常量。<br>14、对于Service和DAO类，基于SOA的理念，暴露出来的服务一定是接口，内部实现类用Impl的后缀与接口区别。<br>如果是形容能力的接口名称，取对应形容词为接口名。<br>15、枚举类名建议带上Enum后缀，枚举成员名称需要全部大写，单词用下划线隔开。<br>16、各层命名规约：<br>Service/DAO：<br>(1)获取单个对象的方法用get做前缀。<br>(2)获取多个对象的方法用list做前缀，复数形式结尾如listObjects。<br>(3)获取统计值的方法使用count做前缀。<br>(4)插入的方法用save/insert做前缀。<br>(5)删除的方法用remove/delete做前缀。<br>(6)修改的方法用update做前缀。<br>领域模型命名规约<br>(1)数据对象：xxxDO,xxx为数据表名<br>(2)数据传输对象:xxxDTO,xxx为业务领域相关的名称<br>(3)展示对象:xxxVO,xxx一般为网页名称<br>(4)POJO是DO/DTO/BO/VO的同城，禁止命名成xxxPOJO</p>
<hr>
<h5 id="（二）常量定义"><a href="#（二）常量定义" class="headerlink" title="（二）常量定义"></a>（二）常量定义</h5><p>1、不允许任何魔法值（未经预先定义的常量）直接出现在代码中<br>2、在long或者Long赋值时，数值后使用大写的L，不能时小写的l，小写容易跟数字1混淆，造成误解。<br>3、常量应该按功能归类，分开维护。<br>4、常量的复用层次有五层：跨应用共享常量、应用内共享常量、子工程内共享常量、包内共享常量、类内共享常量。<br>跨应用共享常量：放置在第二方库通常是client.jar中的constant目录下<br>应用内共享常量：放置在第一方库，在子模块constant下<br>子工程内共享常量：放置在当前子工程constant目录<br>包内共享常量：当前包下单独的constant目录下<br>类内共享常量：当前类下进行定义</p>
<p>5、变量值仅在一个固定范围内变化用enum类型定义</p>
<h5 id="（三）代码格式"><a href="#（三）代码格式" class="headerlink" title="（三）代码格式"></a>（三）代码格式</h5><p>1、大括号使用约定。<br>    (1)左大括号前不换行<br>   (2)左大括号后换行<br>   (3)右大括号前换行<br>   (4)右大括号后还有else等代码不换行：表示终止的右大括号后必须换行。<br>2、左小括号和字符之间不出现空格：右小括号和字符之间也不出现空格；而左大括号前需要空格。<br>3、if/for/while/switch/do 等保留与括号之间都必须加空格。<br>4、任何二目运算符、三目运算符的左右两边都需要加一个空格。<br>5、才用4个空格缩进，进制使用tab字符。<br>6、注释的双斜线与注释内容之间有且只有一个空格。<br>7、单行字数限制不超过120个，超出需要换行，换行遵循如下原则：<br>(1)第二行相对第一行缩进4个空格，从第三行开始，不再继续缩进<br>(2)运算符与下文一起换行<br>(3)方法调用的点符号与下文一起换行<br>(4)方法调用中的多个参数需要换行时，在逗号后进行<br>(5)在括号前不要换行</p>
<p>8、方法参数在定义和传入时，多个参数逗号后边必须加空格。</p>
<p>9、IDE的text file encoding 设置为utf-8;ide中文件的换行符使用unix格式，不要使用window格式。<br>10、单个方法的总行数不超过80行。包括签名、括号，注释以及不可见字符。<br>11、没有必要增加若干空格来使某一行的字符对齐上一行的对应字符。<br>12、不同逻辑、不同语义、不同业务的代码之间插入一个空行分隔开来以提升可读性。</p>
<h5 id="（四）OOP规约"><a href="#（四）OOP规约" class="headerlink" title="（四）OOP规约"></a>（四）OOP规约</h5><p>1、避免通过一个类的对象引用访问此类的静态变量或者静态方法，无谓增加编译器成本，直接使用类名访问。</p>
<p>2、所有的重载方法，必须加<figure class="highlight plain"><figcaption><span>```注解</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">3、相同参数类型，相同业务含义，才可以使用Java可变参数，避免使用Object。</span><br><span class="line">4、外部正在调用或者二方库依赖的接口，不允许修改方法的签名，避免对接口调用产生影响。接口过时必须用``` @Deprecated ```注解，并清晰地说明才用的新接口或者新服务是什么。</span><br><span class="line">5、不能使用过时的类或者方法。</span><br><span class="line">6、Object的equals方法容易抛空指针异常，应使用常量或确定有值的对象来调用equals。</span><br><span class="line">7、所有的相同类型的包装类对象之间值的比较，全部使用equals方法比较</span><br><span class="line">8、基本数据类型与包装数据类型的使用标准如下</span><br><span class="line">(1)所有的POJO类属性必须使用包装数据类型</span><br><span class="line">(2)RPC方法的返回值和参数必须使用包装数据类型</span><br><span class="line">(3)所有的局部变量使用基本数据类型</span><br><span class="line">9、定义DO/DTO/VO等POJO类时，不要设定任何属性默认值。</span><br><span class="line">10、序列化类新增属性的时候，不修改serialVersionUID字段，避免反序列化失败。</span><br><span class="line"></span><br><span class="line">11、构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，放在init方法中。</span><br><span class="line"></span><br><span class="line">12、POJO类必须写toString。使用IDE工具自动生成，如果继承了另外的POJO类，注意在前面加一下super.toString.</span><br><span class="line"></span><br><span class="line">13、禁止在POJO类中，同时存在对应属性xxx的isXxx（）和getXxxx（）方法。</span><br><span class="line"></span><br><span class="line">14、使用索引访问用String的split方法得到的数组时，需做最后一个分隔符后有无内容的检查，否则有抛出IndexOutOfBoundException的风险。</span><br><span class="line"></span><br><span class="line">15、当一个类有多个构造方法，或者多个同名方法，这些方法应该按顺序放置在一起，便于阅读，此条优先于第16条规则。</span><br><span class="line"></span><br><span class="line">16、类内方法定义的顺序依次是：公有方法或保护方法&gt;私有方法&gt;getter/setter方法。</span><br><span class="line"></span><br><span class="line">17、setter方法中，参数名称与类成员变量名称一致，this.成员名 = 参数名。在getter/setter方法中，不要增加业务逻辑，增加排查问题的难度。</span><br><span class="line"></span><br><span class="line">18、循环体内，字符串的连接方式，使用StringBuilder的append方法进行扩展。</span><br><span class="line"></span><br><span class="line">19、final可以声明类、成员变量、方法、以及本地变量，下列情况使用final关键字：</span><br><span class="line">（1）不允许被继承的类，如String类</span><br><span class="line">（2）不允许修改引用的域对象</span><br><span class="line">（3）不允许被重写的方法，如：POJO类的setter方法</span><br><span class="line">（4）不允许运行过程中重新赋值的局部变量。</span><br><span class="line">（5）避免上下文重复使用的一个变量，使用final描述可以强制重新定义一个变量，方便更好的重构。</span><br><span class="line"></span><br><span class="line">20慎用Object的clone方法来拷贝对象。</span><br><span class="line"></span><br><span class="line">21类成员与方法访问控制从严：</span><br><span class="line">（1）如果不允许外部直接通过new来创建对象，构造方法必须是private</span><br><span class="line">（2）工具类不允许有public 或者default构造方法</span><br><span class="line">（3）类非static成员变量并且与子类共享，必须是protected。</span><br><span class="line">（4）类非static成员变量并且仅在本类使用，必须是private。</span><br><span class="line">（5）类static成员变量如果仅在本类使用，必须是private。</span><br><span class="line">（6）若是static成员变量，考虑是否为final。</span><br><span class="line">（7）类成员方法只供类内部调用，必须是private</span><br><span class="line">（8）若类成员方法只对继承公开，那么限制为protected。</span><br><span class="line"></span><br><span class="line">##### （四）集合处理</span><br><span class="line"></span><br><span class="line">1、关于hashCode和equals的处理</span><br><span class="line">	（1）只要重写equals，就必须重写hashCode</span><br><span class="line">   （2）因为Set存储不重复对象，依据hashCode和equals进行判断，所以Set存储的对象必须重写这两个方法。</span><br><span class="line">   （3）如果自定义对象作为Map的键，那么必须重写hashCode和equeals</span><br><span class="line">   </span><br><span class="line">2、ArrayList的subList结果不可强转成ArrayList否则会抛出ClassCaseException异常，即java.utilRandomAccessSubList cannot be cast to java.util.ArrayList.</span><br><span class="line"></span><br><span class="line">3、在subList场景中，高度注意对原集合元素的增加或删除，均会导致子列表的遍历、增加、删除产生ConcurrentModificationException 异常。</span><br><span class="line"></span><br><span class="line">4、使用集合转数组的方法，必须使用集合的```toArray(T[] array)```, 传入的是类型完全一样的数组，大小就是```list.size()```.</span><br><span class="line">直接使用toArray无参方法存在问题，此方法返回值只能是```Object[]```类，若强转其它类型数组将出现ClassCastException错误。</span><br><span class="line">5、使用工具类Array.asList()把数组转换成集合时，不能使用其修改集合相关的方法，它的add/remove/clear方法会抛出UnsupportedOperationException异常。</span><br><span class="line"></span><br><span class="line">6、泛型通配符&lt;? extends T&gt;来接收返回的数据，此写法的泛型集合不能使用add方法，而&lt;? super T&gt;不能使用get方法，作为接口调用赋值时易出错，PECS原则：第一、频繁往外读取内容的，适合用&lt;? extends T&gt;. 第二、经常往里插入的，适用用&lt;? super T&gt;.</span><br><span class="line"></span><br><span class="line">7、不要foreach循环里进行元素的remove/add操作。remove元素请适用Iterator方式，如果并发，需要对Iterator对象加锁。</span><br><span class="line"></span><br><span class="line">8、在JDK1.7版本及以上，Comparator实现类要满足以下三个条件，不然Array.sort，Collections.sort会报IllegalgumentException异常。</span><br><span class="line"></span><br><span class="line">9、集合泛型定义时，在JDK7及以上，使用diamond语法或者全省略。</span><br><span class="line">说明：菱形泛型，即diamond，使用&lt;&gt;代替前面指定的类型。</span><br><span class="line"></span><br><span class="line">10、集合初始化时，指定集合初始化大小</span><br><span class="line">例：HashMap，initialCapacity=(需要存储的元素个数/负载因子) + 1。注意负载因子（即loader factor）默认为0.75，如果暂时无法确定初始值大小，请设置为16（即默认值）。HashMap需要放置1024个元素，由于没有设置容量初始大小，随着元素不断增加，容量7次被迫扩大，resize需要重建hash表，严重影响性能。</span><br><span class="line"></span><br><span class="line">11、使用entrySet遍历Map类集合KV，而不是keySet方式进行遍历。</span><br><span class="line">说明：keySet其实是遍历了2次，一次是转为Iterator对象，另一次是从hashMap中取出key所对应的value。而entrySet只是遍历了一次就把key和value都放到了entry中，效率更高。如果是JDK8，使用Map.foreach方法。</span><br><span class="line"></span><br><span class="line">12、高度注意Map类集合K/V能不能存储null值的情况，如下表格</span><br><span class="line"></span><br><span class="line">|集合类|Key|Value|Super|说明|</span><br><span class="line">|---|:--:|---:|</span><br><span class="line">|Hashtable|不允许为null|不允许为null|Dictionary|线程安全|</span><br><span class="line">|ConcurrentHashMap|不允许为null|不允许为null|AbstractMap|锁分段技术（JDK8:CAS）|</span><br><span class="line">|TreeMap|不允许为null|允许为null|AbstractMap|线程不安全|</span><br><span class="line">|HashMap|允许为null|允许为null|AbstractMap|线程不安全|</span><br><span class="line"></span><br><span class="line">由于HashMap的干扰，很多人认为ConcurrentHashMap是可以置入null值，而事实上，存储null值时会抛出NPE异常。</span><br><span class="line"></span><br><span class="line">13、合理利用好集合的有序性(sort)和稳定性(order),避免集合的无序性(unsort)和不稳定性(unorder)带来的负面影响。</span><br><span class="line"></span><br><span class="line">14、利用Set元素唯一的特性，可以快速对一个集合进行去重操作，避免使用List的contains方法进行遍历、对比、去重操作。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### （六）并发处理</span><br><span class="line"></span><br><span class="line">1、获取单例对象需要保证线程安全，其中的方法也要保证线程安全。</span><br><span class="line"></span><br><span class="line">2、创建线程或线程池时请指定有意义的线程名称，方便出错时回溯。</span><br><span class="line"></span><br><span class="line">3、线程资源必须通过线程池提供，不允许在应用中自行显式创建线程。</span><br><span class="line">说明：使用线程池的好处是减少在创建和销毁线程上所消耗的时间以及系统资源的开销，解决资源不足的问题。如果不使用线程池，有可能造成系统创建大量同类线程而导致消耗完内存或者“过度切换”的问题。</span><br><span class="line"></span><br><span class="line">4、线程池不允许使用Executors去创建，而是通过ThreadPoolExecutor的方式，这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。</span><br><span class="line"></span><br><span class="line">5、SimpleDateFormat是线程不安全的类，一般不要定义为static变量，如果定义为static，必须加锁，或者使用DateUtils工具类。</span><br><span class="line"></span><br><span class="line">6、高并发时，同步调用应该考量锁的性能损耗。能用无锁数据结构，就不要用锁；能锁区块，就不要锁整个方法体；能用对象锁，就不要用类锁。</span><br><span class="line">说明：尽可能使加锁的代码块工作量尽可能的小，避免在锁代码块中调用RPC方法。</span><br><span class="line"></span><br><span class="line">7、对多个资源、数据库表、对象同时加锁时，需要保持一致的加锁顺序，否则可能会造成死锁。</span><br><span class="line"></span><br><span class="line">8、并发修改同一记录时，避免更新丢失，需要加锁。要么在应用层加锁，要么在缓存加锁，要么在数据库层使用乐观锁，使用version作为更新依据。</span><br><span class="line">说明：如果每次访问冲突概率小于20%，推荐使用乐观锁，否则使用悲观锁。乐观锁的重试次数不得小于3次</span><br><span class="line"></span><br><span class="line">9、多线程并行处理定时任务时，Timer运行多个TimeTask时，只要其中之一没有捕获抛出的异常，其它任务便会自动终止运行，使用ScheduleExecutorService则没有这个问题。</span><br><span class="line"></span><br><span class="line">10、使用CountDownLatch进行异步转同步操作，每个线程退出前必须调用countDown方法，线程执行代码注意catch异常，确保countDown方法被执行到，避免主线程无法执行至await方法，直到超时才返回结果。</span><br><span class="line"></span><br><span class="line">说明：注意，子线程抛出异常堆栈，不能在主线程try-catch到。</span><br><span class="line"></span><br><span class="line">11、避免Random实例被多线程使用，虽然共享该实例是线程安全的，但会因竞争同一seed导致的性能下降。</span><br><span class="line"></span><br><span class="line">12、在并发场景下，通过双重检查锁（double-checkedlocking）实现延迟初始化的优化问题隐患(可参考The&quot;Double-CheckedLockingisBroken&quot; Declaration)，推荐解决方案中较为简单一种（适用于JDK5及以上版本），将目标属性声明为volatile型。</span><br><span class="line"></span><br><span class="line">13、volatile 解决多线程内存不可见问题。对于一写多读，是可以解决变量同步问题，但是如果多写，同样无法解决线程安全问题。如果是count++操作，使用如下类实现：AtomicIntegercount= newAtomicInteger();count.addAndGet(1);如果是JDK8，推荐使用LongAdder对象，比AtomicLong性能更好（减少乐观锁的重试次数）。</span><br><span class="line"></span><br><span class="line">14、HashMap在容量不够进行resize时由于高并发可能出现死链，导致cpu飙升，在开发过程中可以使用其它数据结构或加锁来规避风险。</span><br><span class="line"></span><br><span class="line">15、ThreadLocal无法解决共享对象的更新问题，ThreadLocal对象建议使用static修饰。这个变量是针对一个线程内所有操作共享的，所以设置为静态变量，所有此类实例共享此静态变量，也就是说在类第一次被使用时装载，只分配一块存储空间，所有此类的对象(只要是这个线程内定义的)都可以操控这个变量。</span><br><span class="line"></span><br><span class="line">##### （七）控制语句</span><br><span class="line"></span><br><span class="line">1、在一个switch块内，每个case要么通过break/return等来终止，要么注释说明程序将继续执行到哪一个case为止；在一个switch块内，都必须包含一个default语句并且放在最后，即使空代码。</span><br><span class="line"></span><br><span class="line">2、在if/else/for/while/do语句中必须使用大括号。即使只有一行代码，避免采用单行的编码方式：if（condition）statements;</span><br><span class="line"></span><br><span class="line">3、在高并发场景中、避免使用“等于”判断作为中断或退出的条件。</span><br><span class="line">说明：如果并发控制没有处理好，容易产生等值判断被“击穿”的情况，使用大于或小于的区间判断条件来代替。</span><br><span class="line"></span><br><span class="line">4、表达异常的分支时，少用if-else方式，这种方式可以改成写成：</span><br><span class="line"></span><br><span class="line">超过3层的if-else的逻辑判断代码可以使用卫语句、策略模式、状态模式等来实现</span><br><span class="line"></span><br><span class="line">5、除常用方法（如getXxx/isXxx）等外，不要在条件判断中执行其它复杂语句，将复杂逻辑判断结果赋值给一个有意义的布尔变量名，以提高可读性。</span><br><span class="line">例子</span><br></pre></td></tr></table></figure></p>
<p>finalboolean existed = (file.open(fileName, “w”) != null) &amp;&amp;(…) || (…);if (existed) {…}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">6、循环体中的语句要考量性能，以下操作尽量移至循环体外处理，如定义对象、变量、获取数据库连接，进行不必要的try-catch操作（这个try-catch是否可以移至循环体外）。</span><br><span class="line"></span><br><span class="line">7、避免采取反逻辑运算符</span><br><span class="line"></span><br><span class="line">8、接口入参保护，这种场景常见的是用作批量操作的接口。</span><br><span class="line"></span><br><span class="line">9、下列情形，需要进行参数校验：</span><br><span class="line">(1)调用频次低的方法</span><br><span class="line">(2)执行时间开销很大的方法。此情形中，参数校验时间几乎可以忽略不计，但如果因为参数错误导致中间执行回退，或者错误，那得不偿失。</span><br><span class="line">(3)需要极高稳定性和可用性的方法</span><br><span class="line">(4)对外提供开放接口，不管是RPC/API/HTTP接口。</span><br><span class="line">(5)敏感权限入口。</span><br><span class="line"></span><br><span class="line">10、下列情形，不需要进行参数校验：</span><br><span class="line">(1)极有可能被循环调用的方法。但在方法说明里必须注明外部参数检查要求。</span><br><span class="line">(2)底层调用频度比较高的方法。比如DAO层</span><br><span class="line">(3)被声明成private只会被自己代码所调用的方法。</span><br><span class="line"></span><br><span class="line">##### （八）注释规约</span><br><span class="line"></span><br><span class="line">1、类、类属性、类方法的注释必须使用Javadoc规范，使用``` /**内容*/ ```格式,不得使用// xxx方式。</span><br><span class="line"></span><br><span class="line">2、所有的抽象方法必须要用Javadoc注释，说明返回值、参数、异常、子类实现要求、功能、调用注意事项。</span><br><span class="line"></span><br><span class="line">3、类必须添加创建者和创建日期。</span><br><span class="line"></span><br><span class="line">4、方法内部单行注释</span><br><span class="line"></span><br><span class="line">5、所有的枚举类型字段必须要有注释，说明每个数据项的用途</span><br><span class="line"></span><br><span class="line">6、与其“半吊子”英文来注释，不如用中文注释把问题说清楚。专有名词与关键字保持英文原文即可。</span><br><span class="line"></span><br><span class="line">7、代码修改的同时，注释也要进行相应的修改，尤其是参数、返回值、异常、核心逻辑等的修改。</span><br><span class="line"></span><br><span class="line">8、谨慎注释掉代码。在上方详细说明，而不是简单地注释掉。如果无用，则删除。</span><br><span class="line"></span><br><span class="line">9、对于注释的要求：第一、能够准确反应设计思想和代码逻辑；第二、能够描述业务含义，使别的程序员能够迅速了解到代码背后的信息。完全没有注释的大段代码对于阅读者形同天书，注释是给自己看的，即使隔很长时间，也能清晰理解当时的思路；注释也是给继任者看的，使其能够快速接替自己的工作。</span><br><span class="line"></span><br><span class="line">10、好的命名、代码结构是自解释的，注释力求精简准确、表达到位。避免出现注释的一个极端：过多过滥的注释，代码的逻辑一旦修改，修改注释是相当大的负担。</span><br><span class="line"></span><br><span class="line">11、及时清理TODO等标记</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### （九）其它</span><br><span class="line"></span><br><span class="line">1、在使用正则表达式时，利用好其预编译功能，可以有效加快正则匹配速度。</span><br></pre></td></tr></table></figure></p>
<p>private static final Pattern pattern = Pattern.compile(regexRule);<br><code>`</code><br>2、velocity调用POJO类的属性时，建议直接使用属性名取值即可，模板引擎会自动按规范调用POJO的getXxx()，如果是boolean基本数据类型变量（boolean命名不需要加is前缀），会自动调用isXxx()方法。</p>
<p>3、后台输送给页面的变量必须加$!{var} 中间的感叹号</p>
<p>4、注意Math.random()这个方法返回是double类型，注意取值的范围0≤x&lt;1（能够取到零值，注意除零异常），如果想获取整数类型的随机数，不要将x放大10的若干倍然后取整，直接使用Random对象的nextInt或者nextLong方法。</p>
<p>5、获取当前毫秒数System.currentTimeMillis();而不是newDate().getTime();说明：如果想获取更加精确的纳秒级时间值，使用System.nanoTime()的方式。在JDK8中，针对统计时间等场景，推荐使用Instant类。</p>
<p>6、不要在视图模板中加入任何复杂的逻辑。说明：根据MVC理论，视图的职责是展示，不要抢模型和控制器的活。</p>
<p>7、任何数据结构的构造或初始化，都应指定大小，避免数据结构无限增长吃光内存。</p>
<p>8、及时清理不再使用的代码段或配置信息。说明：对于垃圾代码或过时配置，坚决清理干净，避免程序过度臃肿，代码冗余。正例：对于暂时被注释掉，后续可能恢复使用的代码片断，在注释代码上方，统一规定使用三个斜杠(///)来说明注释掉代码的理由。</p>
<h4 id="二、异常日志"><a href="#二、异常日志" class="headerlink" title="二、异常日志"></a>二、异常日志</h4><p>(一)、异常处理<br>1、java类库中定义的可以通过预检查方式规避的异常，不应该通过catch处理，如NullPointException。</p>
<p>2、异常不要用来做流程控制，条件控制。<br>说明：异常的初衷是解决程序运行的各种意外情况，效率比条件判断低很多。</p>
<p>3、catch时分清稳定代码和非稳定代码，对非稳定代码的catch尽可能进行区分异常类型，再做对应的异常处理。<br>说明：不应该对多个不同执行动作的代码进行try-catch，异常不利于准确定位。</p>
<p>4、异常捕获后必须进行处理，不处理异常应该抛给调用者。最外层调用者必须处理异常。</p>
<p>5、事务代码中有try-catch，catch异常后，如果要回滚事务，一定注意手动回滚事务。</p>
<p>6、finally块必须对资源对象，流对象进行关闭，有异常也要try-catch.如果 JDK7 及以上，可以使用 try-with-resources </p>
<p>7、不要在finally块中使用return。<br>说明：finally 块中的 return 返回后方法结束执行，不会再执行 try 块中的 return 语句。 </p>
<p>8、捕获异常与抛异常，必须是完全匹配，或者捕获异常是抛异常的父类。</p>
<p>9、方法的返回值可以为null，不强制返回空集合，或者空对象等， 必须添加注释充分说明什么情况下会返回null<br>说明：本手册明确防止 NPE 是调用者的责任。即使被调用方法返回空集合或者空对象，对调用<br>者来说，也并非高枕无忧，必须考虑到远程调用失败、序列化失败、运行时异常等场景返回 null 的情况。</p>
<p>10、防止 NPE，是程序员的基本修养，注意 NPE 产生的场景：<br> (1)返回类型为基本数据类型，return 包装数据类型的对象时，自动拆箱有可能产生 NPE。     反例：public int f() { return Integer 对象}， 如果为 null，自动解箱抛 NPE。<br> (2) 数据库的查询结果可能为 null。<br> (3)集合里的元素即使 isNotEmpty，取出的数据元素也可能为 null。<br> (4) 远程调用返回对象时，一律要求进行空指针判断，防止 NPE。<br> (5)对于 Session 中获取的数据，建议 NPE 检查，避免空指针。<br> (6)级联调用 obj.getA().getB().getC()；一连串调用，易产生 NPE。 正例：使用 JDK8 的 Optional 类来防止 NPE 问题。 </p>
<p>11、定义时区分uncheck/check异常，避免直接抛出new RuntimeException(),更不允许抛出Exception或者Throwable，应使用有业务含义的自定义异常。推荐业界已定义过的自定义异常，如DAOException /Serviception等。</p>
<p>12、对于公司外的http/api开放接口必须使用错误码，而应用内部推荐异常抛出，跨应用间RPC调用优先考虑使用Result方式，封装isSuccess()方法、错误码、错误简短信息。</p>
<p>13、避免出现重复的代码（Don’t Repeat Yourself），即 DRY 原则。 说明：随意复制和粘贴代码，必然会导致代码的重复，在以后需要修改时，需要修改所有的副 本，容易遗漏。必要时抽取共性方法，或者抽象公共类，甚至是组件化。 正例：一个类中有多个 public 方法，都需要进行数行相同的参数校验操作，这个时候请抽取： private boolean checkParam(DTO dto) {…} </p>
<p>（二）日志规约<br>1、应用中不可直接使用日志系统（Log4j、Logback）中的 API，而应依赖使用日志框架 SLF4J 中的 API，使用门面模式的日志框架，有利于维护和各个类的日志处理方式统一。 </p>
<p>2、日志文件至少保存 15 天，因为有些异常具备以“周”为频次发生的特点。</p>
<p>3、应用中的扩展日志（如打点、临时监控、访问日志等）命名方式： appName_logType_logName.log。 logType:日志类型，如 stats/monitor/access 等；logName:日志描述。这种命名的好处： 通过文件名就可知道日志文件属于什么应用，什么类型，什么目的，也有利于归类查找。 正例：mppserver 应用中单独监控时区转换异常，如：                                 mppserver_monitor_timeZoneConvert.log 说明：推荐对日志进行分类，如将错误日志和业务日志分开存放，便于开发人员查看，也便于 通过日志对系统进行及时监控。</p>
<p>4、对 trace/debug/info 级别的日志输出，必须使用条件输出形式或者使用占位符的方 式。 说明：logger.debug(“Processing trade with id: “ + id + “ and symbol: “ + symbol); 如果日志级别是 warn，上述日志不会打印，但是会执行字符串拼接操作，如果 symbol 是对象， 会执行 toString()方法，浪费了系统资源，执行了上述操作，最终日志却没有打印。 正例：（条件）建设采用如下方式 if (logger.isDebugEnabled()) {    logger.debug(“Processing trade with id: “ + id + “ and symbol: “ + symbol);   }       正例：（占位符） logger.debug(“Processing trade with id: {} and symbol : {} “, id, symbol);</p>
<p>5、避免重复打印日志，浪费磁盘空间，务必在 log4j.xml 中设置 additivity=false。<br> 正例：<logger name="com.taobao.dubbo.config" additivity="false"> </logger></p>
<p>6、异常信息应该包括两类信息：案发现场信息和异常堆栈信息。如果不处理，那么通过 关键字 throws 往上抛出。 正例：logger.error(各类参数或者对象 toString() + “_” + e.getMessage(), e); </p>
<p>7、谨慎地记录日志。生产环境禁止输出 debug 日志；有选择地输出 info 日志；如果使 用 warn 来记录刚上线时的业务行为信息，一定要注意日志输出量的问题，避免把服务器磁盘 撑爆，并记得及时删除这些观察日志。 说明：大量地输出无效日志，不利于系统性能提升，也不利于快速定位错误点。记录日志时请 思考：这些日志真的有人看吗？看到这条日志你能做什么？能不能给问题排查带来好处？ </p>
<p>8、可以使用 warn 日志级别来记录用户输入参数错误的情况，避免用户投诉时，无所适 从。如非必要，请不要在此场景打出 error 级别，避免频繁报警。  说明：注意日志输出的级别，error 级别只记录系统逻辑出错、异常或者重要的错误信息。 </p>
<p>9、尽量用英文来描述日志错误信息，如果日志中的错误信息用英文描述不清楚的话使用 中文描述即可，否则容易产生歧义。国际化团队或海外部署的服务器由于字符集问题，使用全英文来注释和描述日志错误信息。  </p>
<h4 id="三、单元测试"><a href="#三、单元测试" class="headerlink" title="三、单元测试"></a>三、单元测试</h4><p>1、好的单元测试必须遵守 AIR 原则。 说明：单元测试在线上运行时，感觉像空气（AIR）一样并不存在，但在测试质量的保障上， 却是非常关键的。好的单元测试宏观上来说，具有自动化、独立性、可重复执行的特点。 </p>
<ul>
<li>A：Automatic（自动化） </li>
<li>I：Independent（独立性） </li>
<li>R：Repeatable（可重复） </li>
</ul>
<p>2、单元测试应该是全自动执行的，并且非交互式的。测试用例通常是被定期执行的，执 行过程必须完全自动化才有意义。输出结果需要人工检查的测试不是一个好的单元测试。单元 测试中不准使用 System.out 来进行人肉验证，必须使用 assert 来验证。 </p>
<p>3、保持单元测试的独立性。为了保证单元测试稳定可靠且便于维护，单元测试用例之间 决不能互相调用，也不能依赖执行的先后次序。 反例：method2 需要依赖 method1 的执行，将执行结果作为 method2 的输入。 </p>
<p>4、单元测试是可以重复执行的，不能受到外界环境的影响。 说明：单元测试通常会被放到持续集成中，每次有代码 check in 时单元测试都会被执行。如 果单测对外部环境（网络、服务、中间件等）有依赖，容易导致持续集成机制的不可用。 正例：为了不受外界环境影响，要求设计代码时就把 SUT 的依赖改成注入，在测试时用 spring 这样的 DI 框架注入一个本地（内存）实现或者 Mock 实现。 </p>
<p>5、对于单元测试，要保证测试粒度足够小，有助于精确定位问题。单测粒度至多是类级别，一般是方法级别。<br>说明：只有测试粒度小才能在出错时尽快定位到出错位置。单测不负责检查跨类或者跨系统的 交互逻辑，那是集成测试的领域。 </p>
<p>6、核心业务、核心应用、核心模块的增量代码确保单元测试通过。 说明：新增代码及时补充单元测试，如果新增代码影响了原有单元测试，请及时修正。 </p>
<p>7、单元测试代码必须写在如下工程目录：src/test/java,不允许写在业务代码目录下。<br>说明：源码构建时会跳过此目录，而单元测试框架默认是扫描此目录。 </p>
<p>8、单元测试的基本目标：语句覆盖率达到70%；核心模块的语句覆盖率和分支覆盖率都应该进行单元测试。</p>
<p>9、编写单元测试代码遵守bcde原则，以保证被测试模块的交付质量。</p>
<p>10、对于数据库相关的查询，更新，删除等操作，不能假设数据库里的数据是存在的，或者直接操作数据库把数据插入进去，请使用程序插入或者导入数据的方式来准备数据。</p>
<p>11、和数据库相关的单元测试，可以设定自动回滚机制，不给数据库造成脏数据。或者 对单元测试产生的数据有明确的前后缀标识。 </p>
<p>12、和数据库相关的单元测试，可以设定自动回滚机制，避免为了达到测试要求而书写不规范测试代码</p>
<p>13、在设计评审阶段，开发人员需要和测试人员一起确定单元测试范围，单元测试最好覆盖所有测试用例。</p>
<p>14、单元测试作为一种质量保障手段，不建议项目发布后补充单元测用例，建议在项目提测前完成单元测试。</p>
<p>15、为了更方便地进行单元测试，业务代码应避免以下情况：</p>
<ul>
<li>构造方法中做的事情过多。</li>
<li>存在过多的全局变量和静态方法。</li>
<li>存在过多的外部依赖。</li>
<li>存在过多的条件语句。</li>
</ul>
<p>16、不要多单元测试存在如下误解</p>
<ul>
<li>那是测试同学干的事情。本文是开发手册，凡是本文内容都是与开发同学强相关的。  </li>
<li>单元测试代码是多余的。系统的整体功能与各单元部件的测试正常与否是强相关的。  </li>
<li>单元测试代码不需要维护。一年半载后，那么单元测试几乎处于废弃状态。  </li>
<li>单元测试与线上故障没有辩证关系。好的单元测试能够最大限度地规避线上故障。</li>
</ul>
<h4 id="四、安全规约"><a href="#四、安全规约" class="headerlink" title="四、安全规约"></a>四、安全规约</h4><p>1、隶属于用户个人的页面或者功能必须进行权限控制校验。</p>
<p>2、用户敏感数据禁止直接展示，必须对展示数据进行脱敏。</p>
<p>3、用户输入的sql参数严格使用参数绑定或者METADATA字段限定，防止sql注入，禁止字符串拼接sql访问数据库。</p>
<p>4、用户请求传入的任何参数必须做有效性验证。<br>忽略参数校验可能导致：  </p>
<ul>
<li>page size 过大导致内存溢出  </li>
<li>恶意 order by 导致数据库慢查询  </li>
<li>任意重定向  SQL 注入  </li>
<li>反序列化注入  </li>
<li>正则输入源串拒绝服务 ReDoS<br>说明：Java 代码用正则来验证客户端的输入，有些正则写法验证普通用户输入没有问题， 但是如果攻击人员使用的是特殊构造的字符串来验证，有可能导致死循环的结果。 </li>
</ul>
<p>5、禁止向HTML页面输出未经安全过滤或未正确转义的用户数据。</p>
<p>6、表单、ajax提交必须执行csrf安全验证。</p>
<p>7、在使用平台资源，譬如短信、邮件、电话、下单、支付，必须实现正确的防重放的机制，如数量限制、疲劳度控制、验证码校验，避免被滥刷导致资源损耗。</p>
<p>8、发贴、评论、发送即时消息等用户生成内容的场景必须实现防刷、文本内容违禁词过 滤等风控策略。 </p>
<p>五、Mysql数据库<br>（一）建表规约</p>
<p>1、表达是与否概念的字段，必须使用is_xxx的方式命名，数据类型unsigned tinyint（1表示是，0表示否）</p>
<p>2、表名、字段名必须使用小写字母或者数字，禁止出现数字开头，禁止两个下划线中间只出现数字。数据库字段名的修改代价很大，因为无法进行预发布，所以字段名称需要慎重考虑。<br>说明：MySQL 在 Windows 下不区分大小写，但在 Linux 下默认是区分大小写。因此，数据库名、 表名、字段名，都不允许出现任何大写字母，避免节外生枝。 </p>
<p>3、表名不适用复数名词。</p>
<p>4禁用保留字，参考mysql官方。</p>
<p>5、主键索引名为 pk_字段名；唯一索引名为 uk_字段名；普通索引名则为 idx_字段名。</p>
<p>6、小数类型为 decimal，禁止使用 float 和 double。</p>
<p>7、如果存储的字符串长度几乎相等，使用 char 定长字符串类型。 </p>
<p>8、varchar 是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长 度大于此值，定义字段类型为 text，独立出来一张表，用主键来对应，避免影响其它字段索 引效率。 </p>
<p>9、表必备三字段：id, gmt_create, gmt_modified。<br>说明：其中 id 必为主键，类型为 bigint unsigned、单表时自增、步长为 1。gmt_create, gmt_modified 的类型均为 datetime 类型，前者现在时表示主动创建，后者过去分词表示被 动更新。 </p>
<p>10、表的命名最好是加上“业务名称_表的作用”。 正例：alipay_task / force_project / trade_config </p>
<p>11、库名与应用名称尽量一致。 </p>
<p>12、如果修改字段含义或对字段表示的状态追加时，需要及时更新字段注释。 </p>
<p>13、字段允许适当冗余，以提高查询性能，但必须考虑数据一致。冗余字段应遵循：</p>
<p> （1）不是频繁修改的字段。<br> （2）不是 varchar 超长字段，更不能是 text 字段。 </p>
<p>14、单表行数超过500万行或者单表容量超过2G，才推荐进行分库分表。</p>
<p>15、合适的字符存储长度，不但节约数据库表空间、节约索引存储，更重要的是提升检索速度。</p>
<p>正例：如下表，其中无符号值可以避免误存负数，且扩大了表示范围。 </p>
<table>
<thead>
<tr>
<th>对象</th>
<th style="text-align:center">年龄区间</th>
<th style="text-align:right">类型</th>
<th>字节</th>
<th>表示范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>人</td>
<td style="text-align:center">150 岁之内</td>
<td style="text-align:right">tinyint unsigned</td>
<td>1</td>
<td>无符号值：0 到 255</td>
</tr>
<tr>
<td>龟</td>
<td style="text-align:center">数百岁</td>
<td style="text-align:right">smallint unsigned</td>
<td>2</td>
<td>无符号值：0 到 65535</td>
</tr>
<tr>
<td>恐龙化石</td>
<td style="text-align:center">数千万年</td>
<td style="text-align:right">int unsigned</td>
<td>4</td>
<td>无符号值：0 到约 42.9 亿</td>
</tr>
<tr>
<td>太阳</td>
<td style="text-align:center">约 50 亿年</td>
<td style="text-align:right">bigint unsigned</td>
<td>8</td>
<td>无符号值：0 到约 10 的 19 次方</td>
</tr>
</tbody>
</table>
<p>二、索引规约</p>
<p>1、业务上具有唯一特性的字段，即使是多个字段的组合，也必须建成唯一索引。</p>
<p>2、超过三个表禁止join。需要join的字段，数据类型数据类型必须绝对一致；多表关联查询时，保证被关联的字段需要有索引。</p>
<p>3、在varchar字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据实际文本区分度决定索引长度即可。</p>
<p>4、页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。</p>
<p>5、如果有order by 的场景，请注意利用索引的有序性。order by 最后的字段是组合索引的一部分，并且放在索引组合顺序的最后，避免出现file_sort的情况，影响查询性能。</p>
<p>6、利用覆盖索引来进行查询操作，避免回表。</p>
<p>7、利用延迟关联或者子查询优化超多分表场景。</p>
<p>8、sql性能优化的目标：至少要达到range级别，要求是ref级别，如果可以是consts最好。</p>
<p>9、建立组合索引的时候，区分度最高的在左边。</p>
<p>10、防止因字段类型不同造成的隐式转换，导致索引失效。</p>
<p>11、创建索引时避免有如下极端误解：<br>（1）宁滥勿缺。认为一个查询就需要一个索引。<br>（2）宁缺毋滥。认为索引会消耗空间、严重拖慢更新和新增速度。<br>（3）抵制唯一索引。认为业务的唯一性一律需要在应用层通过“先查后插”方式解决。</p>
<p>（三）sql语句</p>
<p>1、不要使用count或count来替代count（<em>），count（</em>）是sql92定义的标准统计行数的语法，根数据库无关，跟null和非null无关。</p>
<p>2、count（distinct col）计算该列除null之外的不重复行数，注意count（distinct，col1，col1）如果其中一列全为null，那么即使另一列有不同的值，也返回0.</p>
<p>3、当某一列的值全是null时，count（col）返回结果为0，但sum（col）的返回结果为null,因此使用sum（）时需注意npe问题。</p>
<p>4、使用isnull（）来判断是否为null值<br>（1）null&lt;&gt;null的的返回值结果是null，而不是false。<br>（2）null=null的返回结果是null，而不是true。<br>（3）null&lt;&gt;1的返回结果是null，而不是true。</p>
<p>5、在代码中写分页查询逻辑时，若count为0应直接返回，避免执行后面的分页语句。</p>
<p>6、不得使用外键，一切分页的概念必须在应用层解决。</p>
<p>7、禁止使用存储过程</p>
<p>考试记录：10月8号下午，天气晴，62分，用时30到40分左右，规范的细节把握不够，对二方库部分不熟</p>

      
    </div>
    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/wechat-qcode.jpg" alt="smith-dog wechat" style="width: 200px; max-width: 100%;"/>
    <div>Welcome to sweep the above WeChat public address and subscribe to my blog!</div>
</div>

      </div>
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/java/" rel="tag"># java</a>
          
            <a href="/tags/alibaba/" rel="tag"># alibaba</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/29/redis-深度历险（一）/" rel="prev" title="redis深度历险（一）">
                redis深度历险（一） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
  <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=298 height=52 src="//music.163.com/outchain/player?type=2&id=462698572&auto=1&height=32"></iframe>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/head.png"
                alt="smith-dog" />
            
              <p class="site-author-name" itemprop="name">smith-dog</p>
              <p class="site-description motion-element" itemprop="description">The road ahead is bright, keeping the unity of knowing and doing.</p>
          </div>
		  
		  
		  
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/smith-dog" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#一、编程规约"><span class="nav-number">1.</span> <span class="nav-text">一、编程规约</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#（一）命名风格"><span class="nav-number">1.1.</span> <span class="nav-text">（一）命名风格</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#（二）常量定义"><span class="nav-number">1.2.</span> <span class="nav-text">（二）常量定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#（三）代码格式"><span class="nav-number">1.3.</span> <span class="nav-text">（三）代码格式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#（四）OOP规约"><span class="nav-number">1.4.</span> <span class="nav-text">（四）OOP规约</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二、异常日志"><span class="nav-number">2.</span> <span class="nav-text">二、异常日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#三、单元测试"><span class="nav-number">3.</span> <span class="nav-text">三、单元测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#四、安全规约"><span class="nav-number">4.</span> <span class="nav-text">四、安全规约</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">smith-dog</span>

  
</div>
<!--

  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>


  -->

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("teOglp4okTXg4fqzdYTTgX7A-gzGzoHsz", "x1lkkmeCaofwDoun8IkhHl2E");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
